---
title: 对象的引用计数是如何管理的
date: 2019-05-06 22:34:14
tags: objc iOS OC 
---

# 问题
1. iOS如何管理内存
<!-- 如果管理内存 先回答内存分区 我们管理的是哪块区域 ；然后回答我们采用什么方案进行内存管理：我们采用的ARC 使用了自动释放池技术  -->
2. 对象的引用计数是如何管理的 
    * 对象的引用计数保存在哪里
    * 对象的引用计数是如何修改的
iOS采用自动释放池技术和ARC技术管理堆内存
<!-- 此处解释app的内存分区 插入图片  -->
iOS内存分区
    * 栈区：
    * 堆区：
    * 全局区：
    * 文字常量区
    * 程序代码区
<!-- 如何管理堆上的内存 -->
## ARC 
   ARC的全称是AutoReleaseConference自动引用计数 区别于MRC,程序员不需要手动释放，
   * 对于实例变量，编译器会在合适的位置插入内存管理语句
   * 对于临时变量，采用自动释放池技术管理对象的引用计数
   
## autoreleasepool
   autoreleasepool也就是前文提到的自动释放池技术，详情可参考[自动释放池的原理](http://blog.kaolagogogo.fun/2018/11/26/%E8%87%AA%E5%8A%A8%E9%87%8A%E6%94%BE%E6%B1%A0%E7%9A%84%E5%8E%9F%E7%90%86/)

## 管理对象的引用计数
### 问题


### 对象的生命周期

* 生成&持有对象（rc+1）objc initialize(alloc/new/copy/mutableCopy) 
* 持有对象（rc+1）objc retain 
* 释放对象（rc-1）objc release 
* 废弃对象（rc==0）objc dealloc 

* 前面提到的关于引用计数的主要问题是：`对象的引用计数保存在哪里`和`对象的引用计数是如何修改的`
查看objc的源码(我的版本是723，现在有[更新的](https://opensource.apple.com/source/objc4/))
* 找到对象生成、持有、释放时候调用的api
####  生成&持有对象 
<!-- 此处插入函数调用栈 重点解释1. 第一次生成的时候修改了什么地方. -->

#### 持有对象 retain
<!-- 此处 重点解释2. 非生成的时候，rc修改是在什么地方进行修改的 （有两种情况） 2. 每次都是加一吗？是的话 为什么 不是的话 为什么 -->


#### 释放对象 release
<!-- 与持有对象类似，rc修改是在什么地方修改的 每次都是减一吗 是的话 为什么 不是的话 为什么  -->

### 总结一下






